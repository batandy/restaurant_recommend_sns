{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>navermap</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=fxqxlpqj6o"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="{% static 'floating.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">

</head>
<body>
    <div class="container">
        <div class="icons">
            <a id="log" href="{%url 'main:login' %}">login</a>
        </div>

        <!-- 햄버거 메뉴 -->
        <input type="checkbox" id="trigger" >
        <label for="trigger">
            <!-- 햄버거 세줄 표현 -->
            <span></span>
            <span></span>
            <span></span>
        </label>
        <label for="box"></label>
        <div class="main">
            <!-- 메인파트내용 -->
            {% block content %}
            {% endblock %}
            <!-- 끝 -->
        </div>

        <div class="map_posi">
            <div id="map"></div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script type="text/javascript">
        let markers= new Array();
        const markers_x= [];
        let markers_y= new Array();
        let markers_name= new Array();
        var position_test=[];
        var db = "{{restaurant_db}}";
        var locations = "{{restaurant_db}}".replace(/&quot;/g, '"');
        var test_data=locations
        console.log(locations,test_data)
        for(i in test_data){
            console.log(test_data[i])
        }
        var map = new naver.maps.Map('map', {
            zoom: 17
        });
        $.ajax({
            url:"{% url 'getdata'%}",
            dataType: "json",
            success: function (data) {
                console.log(data)
                for (var i = 0; i < data.length; i++) {
                    markers_x.push(data[i].fields.x)
                    markers_y.push(data[i].fields.y)
                    markers_name.push(data[i].fields.name)
                    console.log(data[i].fields.x,data[i].fields.y,data[i].fields.name)
                    position_test.push({
                        title:data[i].fields.name,
                        latlng: new naver.maps.LatLng(data[i].fields.x,data[i].fields.y)
                    })
                }

                for (var i=0; i<2;i++){
                    console.log(position_test[i].latlng,markers_y[i],markers_name[i])


                    var marker=new naver.maps.Marker({
                        position: new naver.maps.LatLng(markers_x[i],markers_y[i]),
                        map: map,
                        title:position_test[i].title
                    });
                }
            },
            error: function (request, status, error) {
                console.log('실패');
            }
        });
        console.log(markers_x,markers_y)
        console.log(position_test)
        for (var i=0; i<2;i++){
            console.log(markers_x[i],markers_y[i],markers_name[i])


            var marker=new naver.maps.Marker({
                position: new naver.maps.LatLng(markers_x[i], markers_y[i]),
                map: map,
                title:markers_name[i]
            });
        }
    </script>
    <!-- 자바스크립트 시작 -->

    </script>

    <script src="{% static 'basic.js' %}"></script>
    <!-- {% block script %} -->
    <!-- {% endblock %} -->
    <!-- 자바스크립트 끝 -->
</body>
<table class="json" style="padding:10px">
    <tr>
        <th>name</th>
        <th>x</th>
        <th>y</th>
        <th>ratenum</th>
        <th>ratetext</th>
    </tr>
    {% for restaurant in restaurant_db%}
        <tr>
            <td>{{restaurant.name}}</td>
            <td>{{restaurant.x}}</td>
            <td>{{restaurant.y}}</td>
            <td>{{restaurant.ratenum}}</td>
            <td>{{restaurant.ratetext}}</td>
        </tr>
    {% endfor %}
</table>

</html>
